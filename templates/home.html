<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>ScamSniff ‚Äì Check a message</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b1220; --card:#121a2b; --muted:#9aa6b2; --text:#e6edf3; }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--text)}
    .wrap{max-width:900px; margin:40px auto; padding:0 16px}
    header{display:flex; align-items:center; gap:12px; margin-bottom:16px}
    header h1{font-size:24px; margin:0}
    nav a{color:#9ecbff; text-decoration:none; margin-right:16px}
    .card{background:var(--card); border:1px solid #1f2a44; border-radius:14px; padding:16px}
    textarea{width:100%; min-height:140px; padding:12px; border-radius:10px; border:1px solid #243253; background:#0f182a; color:#e6edf3; font-size:15px}
    button{padding:10px 16px; border-radius:10px; border:0; cursor:pointer; font-weight:600}
    .primary{background:#2563eb; color:#fff}
    .row{display:flex; gap:16px; flex-wrap:wrap}
    .half{flex:1 1 420px}
    .muted{color:var(--muted); font-size:13px}
    .result{white-space:pre-wrap; background:#0f182a; border:1px solid #243253; border-radius:10px; padding:12px; min-height:100px}
    .badge{display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:700}
    .low{background:#11371e; color:#86efac}
    .med{background:#3a2f00; color:#fde68a}
    .high{background:#3b0d0d; color:#fecaca}
    table{width:100%; border-collapse:collapse; font-size:14px}
    th,td{border-bottom:1px solid #243253; padding:8px 6px; text-align:left}
    th{color:#9aa6b2; font-weight:600}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üõ°Ô∏è ScamSniff</h1>
      <nav>
        <a href="/">Home</a>
        <a href="/history">History</a>
        <a href="/pricing">Pricing</a>
      </nav>
    </header>

    <div class="row">
      <div class="half">
        <div class="card">
          <h2>Analyze a message</h2>
          <p class="muted">Paste text from an email, marketplace chat, or SMS.</p>
          <textarea id="msg" placeholder="Paste message here..."></textarea>
          <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
            <button id="analyze" class="primary">Analyze</button>
            <span id="status" class="muted"></span>
          </div>
        </div>
      </div>

      <div class="half">
        <div class="card">
          <h2>Result</h2>
          <div id="badgeWrap"></div>
          <div id="signalsWrap" style="margin-top:8px;"></div>
          <div id="json" class="result" style="margin-top:8px;"></div>
        </div>
      </div>
    </div>

    <p class="muted" style="margin-top:14px">Tip: we never store personal details‚Äîonly the message text and score for improving rules.</p>
  </div>

  <script>
    // IMPORTANT: same-origin path works locally and on Render (no localhost!)
    async function callAnalyze(message){
      const res = await fetch('/api/analyze', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message })
      });
      if(!res.ok){
        const txt = await res.text().catch(()=> '');
        throw new Error(`Request failed (${res.status}): ${txt || 'no body'}`);
      }
      return res.json();
    }

    function badge(level){
      const span = document.createElement('span');
      span.className = 'badge ' + (level==='HIGH'?'high':level==='MEDIUM'?'med':'low');
      span.textContent = `Risk: ${level}`;
      return span;
    }

    function signalsTable(signals){
      if(!signals || !signals.length) return '';
      let rows = signals
        .map(s => `<tr><td>${s.name}</td><td>${(s.score*100).toFixed(0)}%</td></tr>`)
        .join('');
      return `
        <table>
          <thead><tr><th>Signal</th><th>Weight</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>`;
    }

    const btn = document.getElementById('analyze');
    const msg = document.getElementById('msg');
    const status = document.getElementById('status');
    const jsonOut = document.getElementById('json');
    const badgeWrap = document.getElementById('badgeWrap');
    const signalsWrap = document.getElementById('signalsWrap');

    btn.addEventListener('click', async () => {
      const text = (msg.value || '').trim();
      if(!text){ msg.focus(); return; }
      btn.disabled = true;
      status.textContent = 'Analyzing...';
      badgeWrap.innerHTML = '';
      signalsWrap.innerHTML = '';
      jsonOut.textContent = '';

      try{
        const data = await callAnalyze(text);
        // Pretty JSON (debug)
        jsonOut.textContent = JSON.stringify(data, null, 2);

        // Badge + signals table
        const level = (data.summary || '').toUpperCase().includes('HIGH') ? 'HIGH'
                    : (data.summary || '').toUpperCase().includes('MEDIUM') ? 'MEDIUM'
                    : 'LOW';
        badgeWrap.appendChild(badge(level));
        signalsWrap.innerHTML = signalsTable(data.signals || []);
        status.textContent = 'Done.';
      }catch(e){
        status.textContent = e.message || 'Error';
      }finally{
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
